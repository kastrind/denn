import * as math from 'mathjs';
import { Utils } from './Utils';
import { DataSet } from './DataSet';
import { Denn } from './Denn';

const projectName = 'Test';
const embeddings = require(`./assets/${projectName}/embeddings.json`);

// Load model from file
let nn = Denn.deserialize(`./assets/${projectName}/lm.json`);

//let queries = ["cancel card", "open a new account", "close my account", "card delivery", "what is my credit score", "how is the delivery of my card going", "why is my credit score so low", "when will my card arrive", "close account"];
let queries = ["Cancel my Amex credit card", "Lost my Mastercard cancel it", "Mastercard is lost cancel it", "Request to cancel my Mastercard", "Can't find my Mastercard cancel it", "Help me cancel my Mastercard", "Cancel my Visa credit card", "My Visa card was stolen cancel it", "Lost my Visa card cancel it", "Close my Visa card account", "Cancel my unneeded Visa card", "Help me cancel my credit card", "My card was stolen cancel it", "Lost card cancel and issue a new one", "Lost credit card how to cancel", "No longer need card cancel it", "Cancel my unneeded Visa debit card", "Cancel my Visa debit card not needed", "Don't need Visa debit card cancel it", "Cancel my unneeded Visa debit card", "Cancel Visa debit card right away", "Please cancel my debit card", "Help cancel my unneeded debit card", "Lost debit card cancel and send new one", "Misplaced debit card cancel and replace", "Cancel debit card not meeting needs", "Cancel debit card keep account open", "Debit card stolen cancel it", "Misplaced card cancel it", "Debit card not useful cancel it", "Cancel debit card not meeting needs", "Lost debit card cancel it", "Amex card stolen cancel it", "Stolen Amex card cancel it ASAP", "Lost Amex card cancel it", "Amex card stolen how to cancel", "Cancel unneeded Amex card", "Request card cancellation", "Cancel unused Amex card", "Don't need Amex card cancel it", "Mastercard stolen cancel process", "Cancel unhelpful Mastercard", "Help cancel Mastercard credit card", "Cancel Mastercard found better card", "Card stolen help cancel it", "Cancel Visa card found better option", "Visa card not useful cancel it", "Cancel Visa card found alternative", "Cancel Visa card process", "Stolen card how to cancel", "Cancel cheque deposit from this morning", "Cancel my cheque deposit", "Stop today's cheque deposit", "Cancel cheque deposit from yesterday", "Reverse last week's cheque deposit", "Reverse business account cheque deposit", "Undo CIBC mortgage payment", "Cancel TD Bank car loan payment", "Cancel BMO credit card payment", "Cancel Best Buy payment", "Stop Canadian Tire purchase", "Reverse Bell Canada payment", "Cancel Roots Canada purchase", "Cancel Hudson's Bay purchase", "Reverse Loblaws purchase", "Stop Sobey's purchase", "Cancel TELUS Communications payment", "Reverse Sport Chek purchase", "Undo Hydro payment", "Cancel Rogers bill payment", "Stop Shoppers Drug Mart purchase", "Cancel Indigo purchase", "Stop Scotiabank credit card payment", "Cancel Scotiabank personal loan payment", "Undo Scotia Momentum credit card payment", "Cancel Amex credit card payment", "Cancel loan payment", "Reverse Mastercard payment", "Cancel Interac e-Transfer to friend", "Halt Interac e-Transfer to landlord", "Stop Interac e-Transfer to landlord", "Stop checking to savings transfer", "Cancel checking to investment transfer", "Cancel savings to checking transfer", "Reverse today's RBC wire transfer", "Cancel yesterday's wire transfer", "Reverse wire transfer made today", "Cancel GIC withdrawal request", "Stop mutual fund withdrawal", "Cancel savings accelerator withdrawal", "Reverse GIC withdrawal", "Halt mutual fund withdrawal request", "Undo savings accelerator withdrawal", "Cancel GIC withdrawal request", "Reverse mutual fund withdrawal", "Stop savings accelerator withdrawal request", "Cancel last week's GIC withdrawal", "Cancel mutual fund withdrawal request", "Stop GIC withdrawal", "Cancel savings accelerator withdrawal request", "Amex card delivery status", "Mastercard delivery delay", "Delay in Mastercard delivery", "Visa credit card delivery time", "Visa credit card delivery explanation", "Credit card delivery status", "Credit card delivery update", "Visa debit card arrival time", "Visa debit card delivery date", "Visa debit card arrival estimate", "Visa debit card delivery time", "Debit card arrival time", "Debit card delivery wait", "Debit card delivery demand", "Speed up debit card delivery", "Debit card delivery expectation", "Debit card application status", "Urgent debit card delivery", "Debit card delivery demand", "Debit card delivery ETA", "Amex card delivery update", "Urgent Amex delivery status", "Amex delivery patience running out", "Amex delivery delay reason", "Amex card delivery time", "Amex wait time explanation", "Amex card arrival frustration", "Amex card delivery update", "Amex card delivery status update", "Mastercard delivery status", "Mastercard delivery update", "Expedite Mastercard delivery", "Mastercard delay explanation", "Mastercard delivery status check", "Mastercard delivery delay reason", "Mastercard arrival expectation", "Mastercard delivery delay explanation", "Visa card arrival time", "Visa card delivery update", "Visa card delivery status", "Visa card delivery frustration", "Visa card delivery details", "Visa card delivery status check", "Card delivery status", "Card arrival time", "Visa card delivery wait", "Detailed Visa card delivery update", "Visa card delivery status update", "Card delivery status check", "Card arrival estimate", "Close chequing account", "Close chequing account moving abroad", "Shut down chequing account found better option", "Close chequing account switched banks", "Close Scotiabank chequing account", "Close chequing account unhappy with service", "Close chequing account going digital", "Close chequing account moving", "Cancel chequing account not working out", "Cancel credit card account", "Cancel credit card switching banks", "Cancel high-interest credit card account", "Cancel credit card account reduce credit utilization", "Close too many credit cards account", "Cancel unneeded credit card account", "Terminate credit card account going debt-free", "Cancel credit card account for better benefits", "Help close credit card account", "Close credit card account simplifying finances", "Terminate investment account", "Close liquidated investment account", "Close investment account changing strategy", "Close investment account new account plans", "Cancel investment account move to another institution", "Cancel investment account switch to robo-advisor", "Cancel investment account unhappy with performance", "Close Scotiabank investment account switching banks", "Close line of credit account", "Terminate unused line of credit account", "Close line of credit account paying off debts", "Terminate line of credit account simplifying finances", "Close line of credit account found better offer", "Close line of credit account avoid borrowing", "Close line of credit account high fees", "Close line of credit account focus on mortgage", "Close line of credit account ASAP", "Close unneeded savings account", "Close savings account consolidating finances", "Close savings account invest elsewhere", "Shut down savings account low interest", "Cancel savings account for joint account", "Close savings account open higher interest one", "Close savings account emergency funds needed", "Close savings account switch to high-yield", "Close account high fees", "Cancel account found better rewards", "Close account retiring and accessing funds", "Close account balance paid off", "How to close account", "Close Scotiabank account", "Open chequing account", "Open chequing account for transactions", "Open chequing account for bill payments", "Open chequing account for salary deposit", "Open no-fee chequing account", "Open unlimited transactions chequing account", "Open overdraft protection chequing account", "Open joint chequing account", "Open Scotiabank Basic Chequing Account", "Open Scotiabank credit card account", "Open credit card for online shopping", "Open travel rewards credit card account", "Open low-interest credit card account", "Open cashback rewards credit card account", "Apply for credit card with travel insurance", "Get balance transfer credit card", "Open business expenses credit card account", "Apply for Scotiabank Scene Visa card", "Open Scotiabank Gold Amex card", "Set up investment account", "Open investment account for wealth growth", "Open retirement investment account", "Open investment account for diversification", "Open mutual funds investment account", "Open investment account for mutual funds", "Create long-term financial goals investment account", "Open GIC investment account", "Open emergency expenses line of credit", "Open cash flow management line of credit", "Open home renovation line of credit", "Open a line of credit for debt consolidation", "Open a line of credit for my small business", "Open a line of credit for medical expenses", "Open a line of credit for tuition fees", "Open a line of credit for a home addition", "Open a savings account to save money", "Open a savings account for vacation savings", "Open a savings account for an emergency fund", "Open a savings account for my child's education", "Open a savings account for a down payment", "Open a savings account for wedding savings", "Open a high-interest savings account", "Open a savings account for a new car", "Open a Scotiabank Preferred Package Savings Account", "Open an account", "Help me set up an account", "I'd like to open an account", "How to open an account", "Open a new account", "Assist me in opening a new account", "Check my credit score", "Find out my credit score", "Tell me my credit score", "Check my recent credit score", "Know my credit score", "Provide my credit score", "Explain my low credit score of 550", "Understand why my credit score is 650", "Reasons for credit score below 600", "Advice on boosting my credit score", "Reasons for 700 credit score", "Factors contributing to decreased credit score", "Raise my credit score", "Reasons for 550 credit score", "Steps to enhance credit score", "Changes in credit history since last report", "Reasons for 50-point credit score drop", "Improve credit score focus areas", "Factors for 720 credit score", "Low credit score reasons despite efforts", "Reasons for high credit score", "Mid-range credit score reasons", "Prevent credit score from dropping", "Tips to increase low credit score", "Changes in credit profile since last update", "Improve credit score from 580", "Factors for credit score dropping to 670", "Improve credit score from low to high", "Impact on current credit score", "Increase credit score from 630 to 750", "Explain low credit score", "Reasons for mid-range credit score", "Reasons for 30-point credit score decrease", "Strategies for raising credit score", "Changes in credit report since last check", "Credit score not improving despite on-time payments", "Factors for credit score drop to 610", "Work on credit score for higher level", "Improve credit score from 690", "Changes in credit history leading to lower score", "Insights on current credit score", "Reasons for low credit score of 520", "Credit score drop despite responsible finances", "Increase credit score quickly", "Changes in credit report since last update", "Raise credit score from 640", "Reasons for credit score decline to 680", "Improve current credit score", "Factors causing 710 credit score", "Credit score unchanged since last check", "Request new Amex card due to damage", "New Amex card for expiring card", "Replace lost Mastercard", "Send new Mastercard for lost card", "Request new Mastercard due to malfunction", "Replace lost Mastercard", "Request new Visa card for expiring card", "Replace lost Visa card", "Request new credit card due to loss", "Order new credit card for lost card", "Request replacement for misplaced credit card", "Cancel stolen credit card and issue new one", "Replace cracked credit card", "Replace damaged credit card", "Get new credit card for expiring card", "Request replacement for damaged Visa debit card", "Replace damaged Visa debit card", "Issue new Visa debit card for lost card", "New Visa debit card for stolen card", "Request new Visa debit card for malfunctioning card", "Issue new Visa debit card for expiring card", "Replace misplaced Visa debit card", "Request new Visa debit card for stolen card", "Replace expiring Visa debit card", "Replace damaged Visa debit card", "Issue new debit card for stolen card", "Get new debit card for malfunctioning card", "Request new debit card for damaged card", "Replace damaged debit card", "Send new Amex card for expiring card", "Replace stolen Amex card", "Request new Amex card for lost card", "Replace expiring Amex card", "Request replacement for damaged Amex card", "New Amex card for stolen card", "Send new Amex card for damaged card", "Replace damaged Mastercard", "Send new Mastercard for expiring card", "Order new Mastercard for damaged card", "Request new Mastercard for expiring card", "Request new Mastercard for damaged card", "Send new Mastercard for expiring card", "Order new Mastercard for lost card", "Replace stolen Visa card", "Request new Visa card for expiring card", "Order new Visa card for expiring card", "Replace damaged Visa card", "Replace misplaced card", "Get a new card", "Request new card before expiration", "Employer deposit cleared", "Received employment earnings deposit", "Check work direct deposit status", "Government benefits deposit status", "Tax refund deposit status", "Canada Child Benefit deposit status", "University of Toronto scholarship deposit status", "Insurance claim deposit status", "Received expected deposit", "Cheque deposit processed", "Monthly car loan payment status", "Sun Life Financial premium payment status", "Amazon payment status", "Gap purchase status", "Shopify bill payment status", "Phone bill payment status", "Gym membership payment status", "Expedia booking payment status", "Netflix subscription payment status", "Rogers bill payment status", "Canadian Tire online purchase status", "University of Toronto tuition payment status", "Toronto Hydro utility bill payment status", "Best Buy Canada purchase status", "Scotiabank credit card payment status", "Scotiabank personal loan payment status", "Mortgage payment received by Scotiabank", "Loan payment status", "Mortgage payment applied status", "Online purchase payment cleared", "Credit card bill payment cleared", "Car loan payment status", "Recent account transfer status", "Interac e-Transfer update", "Received etransfer today", "Interac e-Transfer progress", "Landlord e-Transfer status", "Last RRSP transfer status", "Savings account transfer update", "Wire transfer status", "Successful wire transfer", "International wire transfer status", "Savings accelerator withdrawal status", "Investment withdrawal progress", "Mutual fund withdrawal processed", "Retirement savings plan withdrawal status", "Investment account withdrawal status", "GIC withdrawal processed", "TFSA withdrawal status", "RESP withdrawal processed"];
queries.forEach(query => {
  console.log(`Query: ${query}`);
  query = query.toLowerCase();
  let queryTerms = query.split(' ');
  let queryTermEmbedding = [];
  let answer;
  let answers = [];
  let prevQueryTerms = [];
  let outputSum = math.zeros(Object.keys(nn.encoding_to_label_map)[0].length)._data;
  let onehot_array = math.zeros(outputSum.length)._data;
  let max_i;
  queryTerms.forEach(term => {
    if (!prevQueryTerms.includes(term) && embeddings.dictionaryEmbeddings[term]) {
      queryTermEmbedding = embeddings.dictionaryEmbeddings[term];
      answer = nn.predict([queryTermEmbedding]);
      //console.log(term);
      //console.log(nn.output[0]);
      outputSum = math.add(outputSum, nn.output[0]);
      //answers.push(answer);
      prevQueryTerms.push(term);
    }
  });
  //console.log(nn.encoding_to_label_map);
  //console.log(outputSum);
  max_i = nn.maxIndex(outputSum);
  onehot_array[max_i] = 1;
  console.log(nn.encoding_to_label_map[onehot_array.join('')]);
  if (answers.length) {
    console.log(`Answer: ${answers}`);
  }
});
